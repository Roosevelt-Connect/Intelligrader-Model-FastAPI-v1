name: CI-CD Deployment Pipeline

on:
  push:
    branches: [ "main" ]  # Triggers every time you push to the main branch

jobs:
  deploy:
    runs-on: self-hosted  # Targets your Lightsail server
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        # This downloads your code into: 
        # /home/ubuntu/actions-runner/_work/Intelligrader-API/Intelligrader-API

      - name: Deploy with Docker Compose
        run: |
          # 1. Build and restart containers in detached mode
          docker compose up -d --build
          
          # 2. Clean up unused images to save disk space on Lightsail
          docker image prune -f

      - name: Status Check
        run: docker ps